<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic QR Code Page</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    <!-- Add any necessary styles or scripts -->
    <script src="https://cdn.jsdelivr.net/gh/davidshimjs/qrcodejs/qrcode.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f2f2f2;
            margin: 0;
            padding: 0;
            flex-direction: column;
            justify-content: center;
            display:block;
            align-items: center;
            background-image: url('images/background.jpeg');
            background-repeat: repeat;
            background-size: cover;
            overflow: scroll;    
        }   

        .header {
            position: relative;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 35px;
        }

        .blue-line {
            width: 100%;
            height: 8px;
            background-color: #007bff;
            position: absolute; /* Use absolute positioning */
        }

        .header span {
            font-size: 24px;
        }

    
    </style>
</head>
<body>
    <div class="header">
        <h1 id="headerText"></h1>
    </div>

    <div class="blue-line"></div>

    <div id="qrCodeDisplay">
        <canvas id="qrCodeCanvas"></canvas>
        <div id="qrDisplay"></div>
        <div id="remainingTime"></div>
        <div id="qrcode"></div>
    </div>

    <script>
        function generateAndDisplayQRCode() {
          fetch('/getQR')
            .then(response => response.json())
            .then(data => {
              updateQRCode(data.qrCodeDataURL,data.randomText);
            })
            .catch(error => console.error('Error:', error));
            
        }
    
        function updateQRCode(qrCodeDataURL,randomText) {
          const qrDisplay = document.getElementById('qrDisplay');
          qrDisplay.innerHTML = `<img src="${qrCodeDataURL}" alt="QR Code" />`;
          const qrcode = document.getElementById('qrcode');
          qrcode.style.width = '128px';
          qrcode.style.height = '128px';
           qrcode.style.marginTop = '10px';
          qrcode.textContent = `Text: ${randomText}`;
        }
    
        function updateRemainingTime(seconds) {
          const remainingTimeDisplay = document.getElementById('remainingTime');
          const minutes = Math.floor(seconds / 60);
          const remainingSeconds = seconds % 60;
          remainingTimeDisplay.textContent = `Remaining Time: ${minutes}:${remainingSeconds < 10 ? '0' : ''}${remainingSeconds}`;
        }
    
        let timer;
        let seconds = 30;
    
        function startUpdatingQRCode() {
          generateAndDisplayQRCode(); // Call initially
          timer = setInterval(function () {
            updateRemainingTime(seconds);
            seconds--;
    
            if (seconds < 0) {
              clearInterval(timer);
              timer = null;
              seconds = 30;
              startUpdatingQRCode(); // Restart the process
            }
          }, 1000); // Update every second
        }
    
        // Start the process
        startUpdatingQRCode();
      </script>
    
</body>
</html>